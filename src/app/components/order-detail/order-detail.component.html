<div class="container-fluid py-4" *ngIf="order">
  <h3 class="mb-4">Order Details</h3>

  <div class="detail-container">
    <div class="detail-left">
      <!-- Order Detail Fields -->
      <div class="detail-row">
        <div class="detail-label">Order ID</div>
        <div class="detail-colon">:</div>
        <div class="detail-value d-flex justify-content-between align-items-center">
          {{ order.order_id }}
          <button *ngIf="order.status == 'active'" class="btn btn-warning btn-sm ms-3"
            (click)="openPauseModal(pauseModal)">
            {{ order.status === 'active' ? 'Pause' : 'Resume' }}
          </button>
        </div>
        <div class="detail-gap"></div>
        <div class="detail-label">Customer Name</div>
        <div class="detail-colon">:</div>
        <div class="detail-value">{{ order.user.name }}</div>
        <div class="detail-border"></div>
        <div class="detail-label">Address</div>
        <div class="detail-colon">:</div>
        <div class="detail-value">{{ order.delevery_address }}</div>
        <div class="detail-border"></div>
        <div class="detail-label">Email Address</div>
        <div class="detail-colon">:</div>
        <div class="detail-value">{{ order.user.email }}</div>
        <div class="detail-border"></div>
        <div class="detail-label">Phone Number</div>
        <div class="detail-colon">:</div>
        <div class="detail-value">{{ order.user.phone }}</div>
        <div class="detail-border"></div>
        <div class="detail-label">Meals Selected</div>
        <div class="detail-colon">:</div>
        <div class="detail-value meal-selection">
          <span *ngIf="order.preferences[0]?.breakfast" class="meal-item">
            Breakfast
            <span *ngIf="order.preferences[0]?.lunch || order.preferences[0]?.dinner" class="divider">|</span>
          </span>
          <span *ngIf="order.preferences[0]?.lunch" class="meal-item">
            Lunch
            <span *ngIf="order.preferences[0]?.dinner" class="divider">|</span>
          </span>
          <span *ngIf="order.preferences[0]?.dinner" class="meal-item">Dinner</span>
        </div>
        <div class="detail-border"></div>
        <div class="detail-label">Start Date</div>
        <div class="detail-colon">:</div>
        <div class="detail-value">{{ order.start_date | date: 'dd MMM yyyy' }}</div>
        <div class="detail-label">End Date</div>
        <div class="detail-colon">:</div>
        <div class="detail-value">{{ order.end_date | date: 'dd MMM yyyy' }}</div>
        <div class="detail-border"></div>
        <div class="detail-label">Amount</div>
        <div class="detail-colon">:</div>
        <div class="detail-value">â‚¹{{ order.amount }}</div>
        <div class="detail-border"></div>
        <div class="detail-label">Remarks</div>
        <div class="detail-colon">:</div>
        <div class="detail-value">{{ order.remarks }}</div>
      </div>
    </div>

    <div class="detail-right" *ngIf="order.order_pauses.length > 0">
      <h5 class="fw-bold mb-3">Paused Dates</h5>
      <div class="pause-scroll">
        <ul class="pause-list">
          <li *ngFor="let pause of order.order_pauses">
            {{ pause.pause_date | date: 'dd MMM yyyy' }}
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>

<!-- MODAL FOR PAUSE FUNCTIONALITY -->
<ng-template #pauseModal let-modal>
  <div class="modal-header">
    <h5 class="modal-title fw-bold text-danger">Pause Order</h5>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
  </div>

  <div class="modal-body row gx-4">
    <!-- Left Column: Datepicker -->
    <div class="col-12 col-md-7 mb-4 mb-md-0 border-end">
      <p class="mb-2">
        Select the dates you want to pause between:
      </p>
      <p>
        <span class="fw-bold">{{ order?.start_date | date: 'dd MMM yyyy' }}</span> â€“
        <span class="fw-bold">{{ order?.end_date | date: 'dd MMM yyyy' }}</span>
      </p>
      <div class="border rounded p-2">
        <ngb-datepicker
          [dayTemplate]="customDay"
          [markDisabled]="markDisabled"
          outsideDays="hidden"
        ></ngb-datepicker>
      </div>
    </div>

    <!-- Right Column: Selected Dates -->
    <div class="col-12 col-md-5">
      <label class="form-label fw-bold mb-2">Selected Pause Dates:</label>
      <ul class="list-group small scroll-box" *ngIf="selectedDates.length > 0">
        <li *ngFor="let d of selectedDates" class="list-group-item py-1 px-2">
          {{ toDate(d) | date: 'dd MMM yyyy' }}
        </li>
      </ul>
      <p *ngIf="selectedDates.length === 0" class="text-muted">No dates selected</p>
    </div>
  </div>

  <div class="modal-footer">
    <button class="btn btn-outline-secondary" (click)="modal.dismiss()">Cancel</button>
    <button class="btn btn-danger" [disabled]="selectedDates.length === 0" (click)="submitPause(modal)">
      Pause Order
    </button>
  </div>
</ng-template>

<!-- CUSTOM DAY TEMPLATE: disables, highlights pause, and handles click -->
<ng-template #customDay let-date let-currentMonth="currentMonth" let-selected="selected" let-disabled="disabled">
  <span
    class="custom-day"
    [class.bg-danger]="isDateSelected(date) && !isDateAlreadyPaused(date)"
    [class.bg-warning]="isDateAlreadyPaused(date)"
    [class.text-white]="isDateSelected(date) || isDateAlreadyPaused(date)"
    [class.disabled-date]="disabled"
    [class.outside]="date.month !== currentMonth"
    [attr.title]="isDateAlreadyPaused(date) ? 'Already paused' : ''"
    (click)="!disabled && toggleDate(date)">
    {{ date.day }}
  </span>
</ng-template>
